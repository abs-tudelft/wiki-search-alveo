Alveo/SDAccel build scripts
===========================

Description
-----------

This folder contains the SDAccel build scripts and host program/library for
generating and interacting with the Alveo bitstream.

Dependencies
------------

 - Everything in the `hardware` folder (except the simulation itself) should be
   run/generated/checked out.
 - The Python package `vhdeps` must be installed.
 - The SDAccel environment must be sourced. The demo was built for 2018.3.
 - The appropriate XRT directories must be in `$LD_LIBRARY_PATH` and `$PATH`.
 - A C++ compiler with C++11 support must be in `$PATH`. If you're using
   something other than `g++`, change the `CXX` variable in the makefile.
 - Apache Arrow must be installed and linkable by the above compiler.
 - A Wikipedia dataset produced with the `data` folder (or post-processed with
   the `optimize` folder) in order to run the host program.

Usage
-----

To generate the bitstream for the same device and runtime that we built it for,
run `make all TARGET=hw DEVICE=xilinx_u200_xdma_201830_1`. Note that this will
take several hours and a lot of RAM, as is the norm for these massive FPGAs.
If you're targeting a different device, you may need to change the number of
kernels and their distribution over the FPGA fabric in the makefile. You can
also use the `hw_emu` target to generate the files needed to do hardware
emulation.

To build the host application and library, run `make host` (the `make all`
command also does this in addition to generating the bitstream). You can now
run `./host <data-prefix>` to get a basic command-line interface for searching
through a set of record batch files named `<data-prefix>-<number>.rb`, with
`<number>` starting from 0, as generated by the program in the `data`
directory. To run with emulation instead, set the environment variable
`XCL_EMULATION_MODE` to `hw_emu` for the `./host` call.
